<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard</h1>
    <p *ngIf="stats()">Welcome, {{ stats()?.admin_info?.full_name }}</p>
  </div>

  <div *ngIf="isLoading()" class="loading-state">
    <div class="spinner"></div>
    <p>Loading dashboard...</p>
  </div>

  <div *ngIf="errorMessage()" class="error-state">
    <p>{{ errorMessage() }}</p>
    <button (click)="loadDashboard()" class="btn-retry">Retry</button>
  </div>

  <div *ngIf="!isLoading() && !errorMessage() && stats()" class="dashboard-content">
    <!-- User Statistics -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon student">ğŸ‘¨â€ğŸ“</div>
        <div class="stat-info">
          <h3>{{ stats()?.statistics?.total_students }}</h3>
          <p>Total Students</p>
          <span class="stat-sub">{{ stats()?.statistics?.active_students }} active</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon org">ğŸ¢</div>
        <div class="stat-info">
          <h3>{{ stats()?.statistics?.total_organizations }}</h3>
          <p>Organizations</p>
          <span class="stat-sub">{{ stats()?.statistics?.active_organizations }} active</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon admin">ğŸ‘¥</div>
        <div class="stat-info">
          <h3>{{ stats()?.statistics?.total_org_admins }}</h3>
          <p>Org Admins</p>
          <span class="stat-sub">{{ stats()?.statistics?.active_org_admins }} active</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon clearance">âœ…</div>
        <div class="stat-info">
          <h3>{{ stats()?.statistics?.total_clearances }}</h3>
          <p>Total Clearances</p>
          <span class="stat-sub">All time</span>
        </div>
      </div>
    </div>

    <!-- Current Term Statistics -->
    <div class="term-section" *ngIf="stats()?.statistics?.current_term">
      <h2>Current Term: {{ stats()?.statistics?.current_term?.term_name }}</h2>
      <div class="term-stats-grid">
        <div class="term-stat-card total">
          <h3>{{ stats()?.statistics?.current_term?.total_clearances }}</h3>
          <p>Total Clearances</p>
        </div>
        <div class="term-stat-card approved">
          <h3>{{ stats()?.statistics?.current_term?.approved }}</h3>
          <p>Approved</p>
        </div>
        <div class="term-stat-card pending">
          <h3>{{ stats()?.statistics?.current_term?.pending }}</h3>
          <p>Pending</p>
        </div>
        <div class="term-stat-card incomplete">
          <h3>{{ stats()?.statistics?.current_term?.incomplete }}</h3>
          <p>Incomplete</p>
        </div>
      </div>

      <div class="approval-progress">
        <div class="progress-header">
          <span>Approval Progress</span>
          <span class="percentage">{{ getApprovalPercentage() }}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getApprovalPercentage()"></div>
        </div>
      </div>
    </div>

    <div *ngIf="!stats()?.statistics?.current_term" class="no-term-warning">
      <p>âš ï¸ No current academic term is set. Please configure an active term.</p>
      <a routerLink="/terms" class="btn-primary">Go to Terms</a>
    </div>

    <!-- Recent Activity -->
    <div class="recent-activity" *ngIf="stats()?.recent_activity && stats()!.recent_activity.length > 0">
      <h2>Recent Activity</h2>
      <div class="activity-list">
        <div class="activity-item" *ngFor="let activity of stats()!.recent_activity">
          <div class="activity-icon">âœ“</div>
          <div class="activity-details">
            <p class="activity-student">{{ activity.student_name }} ({{ activity.student_number }})</p>
            <p class="activity-org">{{ activity.organization_name }} - <span class="status-{{ activity.status }}">{{ activity.status }}</span></p>
            <p class="activity-date">{{ activity.approved_date | date:'short' }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h2>Quick Actions</h2>
      <div class="actions-grid">
        <a routerLink="/students" class="action-card">
          <span class="action-icon">ğŸ‘¨â€ğŸ“</span>
          <span class="action-label">Manage Students</span>
        </a>
        <a routerLink="/organizations" class="action-card">
          <span class="action-icon">ğŸ¢</span>
          <span class="action-label">Manage Organizations</span>
        </a>
        <a routerLink="/clearances" class="action-card">
          <span class="action-icon">âœ…</span>
          <span class="action-label">View Clearances</span>
        </a>
        <a routerLink="/audit-logs" class="action-card">
          <span class="action-icon">ğŸ“</span>
          <span class="action-label">Audit Logs</span>
        </a>
      </div>
    </div>
  </div>
</div>
