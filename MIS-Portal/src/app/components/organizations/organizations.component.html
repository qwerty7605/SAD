<div class="page-container">
  <div class="page-header">
    <h1>Organization Management</h1>
    <button class="btn-primary" (click)="openCreateModal()">Add Organization</button>
  </div>

  <div class="content-card">
    <!-- Search and Filters -->
    <div class="search-filters">
      <input
        type="text"
        placeholder="Search by name or code..."
        class="search-input"
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearch()"
      >
      <select class="filter-select" [(ngModel)]="statusFilter" (ngModelChange)="onFilterChange()">
        <option value="all">All Status</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
      </select>
      <select class="filter-select" [(ngModel)]="categoryFilter" (ngModelChange)="onFilterChange()">
        <option value="all">All Types</option>
        <option value="academic">Academic</option>
        <option value="administrative">Administrative</option>
        <option value="finance">Finance</option>
        <option value="student_services">Student Services</option>
      </select>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage()" class="error-message">
      {{ errorMessage() }}
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading()" class="loading-spinner">
      <div class="spinner"></div>
      <p>Loading organizations...</p>
    </div>

    <!-- Organizations Table -->
    <div *ngIf="!isLoading() && organizations().length > 0">
      <table class="data-table">
        <thead>
          <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Type</th>
            <th>Department</th>
            <th>Requires Clearance</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let org of organizations()">
            <td>{{ org.org_code }}</td>
            <td>{{ org.org_name }}</td>
            <td>
              <span class="badge"
                [class.academic]="org.org_type === 'academic'"
                [class.administrative]="org.org_type === 'administrative'"
                [class.finance]="org.org_type === 'finance'"
                [class.student-services]="org.org_type === 'student_services'">
                {{ getCategoryLabel(org.org_type) }}
              </span>
            </td>
            <td>{{ org.department || 'N/A' }}</td>
            <td>
              <span class="status-badge" [class.active]="org.requires_clearance" [class.inactive]="!org.requires_clearance">
                {{ org.requires_clearance ? 'Yes' : 'No' }}
              </span>
            </td>
            <td>
              <span class="status-badge" [class.active]="org.is_active" [class.inactive]="!org.is_active">
                {{ org.is_active ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-edit" (click)="openEditModal(org)">Edit</button>
                <button class="btn-delete" (click)="openDeleteModal(org)">Delete</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination">
        <div class="pagination-info">
          Showing {{ (currentPage() - 1) * perPage() + 1 }} to {{ Math.min(currentPage() * perPage(), total()) }} of {{ total() }} organizations
        </div>
        <div class="pagination-buttons">
          <button
            class="pagination-btn"
            (click)="previousPage()"
            [disabled]="currentPage() === 1"
          >
            Previous
          </button>
          <span class="page-info">Page {{ currentPage() }} of {{ totalPages() }}</span>
          <button
            class="pagination-btn"
            (click)="nextPage()"
            [disabled]="currentPage() === totalPages()"
          >
            Next
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading() && organizations().length === 0" class="placeholder-state">
      <div class="placeholder-icon">üèõÔ∏è</div>
      <h3>No Organizations Found</h3>
      <p>No organizations match your current filters.</p>
      <p class="note">Try adjusting your search criteria or add a new organization.</p>
    </div>
  </div>
</div>

<!-- Create/Edit Modal -->
<div *ngIf="showModal()" class="modal-overlay" (click)="closeModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ modalMode() === 'create' ? 'Add New Organization' : 'Edit Organization' }}</h2>
      <button class="modal-close" (click)="closeModal()">&times;</button>
    </div>

    <form (ngSubmit)="onSubmit()">
      <div class="modal-body">
        <div class="form-section">
          <h3>Organization Information</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="org_name">Organization Name *</label>
              <input
                type="text"
                id="org_name"
                [(ngModel)]="formData().org_name"
                name="org_name"
                required
                placeholder="e.g., College of Computer Studies"
              >
            </div>
            <div class="form-group">
              <label for="org_code">Organization Code *</label>
              <input
                type="text"
                id="org_code"
                [(ngModel)]="formData().org_code"
                name="org_code"
                required
                placeholder="e.g., CCS"
              >
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="org_type">Type *</label>
              <select
                id="org_type"
                [(ngModel)]="formData().org_type"
                name="org_type"
                required
              >
                <option value="academic">Academic</option>
                <option value="administrative">Administrative</option>
                <option value="finance">Finance</option>
                <option value="student_services">Student Services</option>
              </select>
            </div>
            <div class="form-group">
              <label for="department">Department</label>
              <input
                type="text"
                id="department"
                [(ngModel)]="formData().department"
                name="department"
                placeholder="e.g., Academic Affairs"
              >
            </div>
          </div>
        </div>

        <div class="form-section">
          <div class="form-row">
            <div class="form-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  [(ngModel)]="formData().requires_clearance"
                  name="requires_clearance"
                >
                Requires Clearance
              </label>
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  [(ngModel)]="formData().is_active"
                  name="is_active"
                >
                Active
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-cancel" (click)="closeModal()">Cancel</button>
        <button type="submit" class="btn-submit">
          {{ modalMode() === 'create' ? 'Create Organization' : 'Update Organization' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteModal()" class="modal-overlay" (click)="closeDeleteModal()">
  <div class="modal modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Confirm Delete</h2>
      <button class="modal-close" (click)="closeDeleteModal()">&times;</button>
    </div>

    <div class="modal-body">
      <p>Are you sure you want to delete this organization?</p>
      <p class="delete-info">
        <strong>{{ organizationToDelete()?.org_name }}</strong><br>
        Code: {{ organizationToDelete()?.org_code }}<br>
        Category: {{ getCategoryLabel(organizationToDelete()?.org_type || '') }}
      </p>
      <p class="warning">This action cannot be undone and may affect related data.</p>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn-cancel" (click)="closeDeleteModal()">Cancel</button>
      <button type="button" class="btn-delete-confirm" (click)="confirmDelete()">Delete Organization</button>
    </div>
  </div>
</div>
